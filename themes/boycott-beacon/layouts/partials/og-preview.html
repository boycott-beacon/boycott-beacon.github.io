{{ $ogImage := "" }}
{{ with .Resources.GetMatch "og.png" }}
{{ $ogImage = .RelPermalink }}
{{ end }}

{{/* Only render the preview if an image is found */}}
{{ if $ogImage }}

{{/* --- Define Share Variables --- */}}
{{ $shareUrl := .Permalink | absURL }}
{{ $shareTitle := .Title }}
{{ $shareDesc := .Params.description | default "" }}

{{/* --- Construct Twitter/X Share Text --- */}}
{{ $twitterIntro := "Learn more:" }}
{{ if $shareTitle }}
{{ $twitterIntro = printf "Learn more about the \"%s\" campaign:" $shareTitle }}
{{ end }}

{{/* Base text includes intro and URL */}}
{{ $twitterTextBase := printf "%s %s" $twitterIntro $shareUrl }}

{{/* Add description if it exists, truncated */}}
{{ $twitterFullText := $twitterTextBase }}
{{ if $shareDesc }}
{{ $truncatedDesc := $shareDesc | truncate 180 }}
{{/* Combine base text, newlines, and truncated description */}}
{{/* Note: Literal newlines in this string are handled correctly by urlquery below */}}
{{ $twitterFullText = printf "%s\n\n%s" $twitterTextBase $truncatedDesc }}
{{ end }}

{{/* --- Custom Encoding for Twitter/X --- */}}
{{/* Step 1: Use urlquery for general encoding (handles quotes, colons, newlines as %0A, etc.) but encodes spaces as '+' */}}
{{ $encodedByHugo := $twitterFullText | urlquery }}
{{/* Step 2: Replace the '+' (from spaces) with '%20' as expected by Twitter */}}
{{ $twitterEncodedText := $encodedByHugo | replace "+" "%20" }}
{{/* Note: This assumes '+' wasn't a literal character in your original title/desc. If it was, it would also become %20. */}}


{{/* --- Render Component --- */}}
<div class="og-preview-wrapper">
  <div class="og-preview-container">
    <div class="og-preview-image" style="background-image: url('{{ $ogImage }}')">
      <!-- Dark overlay covering entire image area -->
      <div class="image-dark-overlay"></div>

      <!-- Social share buttons -->
      <div class="social-share-overlay">
        <div class="social-icons-container">
          {{/* Updated Twitter/X Link with correct encoding */}}
          <a href="https://x.com/intent/tweet?text={{ $twitterEncodedText }}"
             target="_blank" rel="noopener" class="social-icon twitter" title="Share on X">
            <i class="ti-twitter-alt"></i>
          </a>
          {{/* Facebook Link */}}
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ $shareUrl | urlquery }}" {{/* urlquery is fine for FB's 'u' param */}}
          target="_blank" rel="noopener" class="social-icon facebook" title="Share on Facebook">
          <i class="ti-facebook"></i>
          </a>
          {{/* LinkedIn Link */}}
          <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ $shareUrl | urlquery }}&title={{ $shareTitle | urlquery }}" {{/* urlquery is fine here */}}
          target="_blank" rel="noopener" class="social-icon linkedin" title="Share on LinkedIn">
          <i class="ti-linkedin"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Sharing runner at bottom -->
    <div class="sharing-runner">
      <span>Sharing is Support</span>
      <div class="runner-icons">
        <i class="ti-twitter-alt"></i>
        <i class="ti-facebook"></i>
        <i class="ti-linkedin"></i>
      </div>
    </div>
  </div>
</div>
{{ end }}
